<!-- html is the some markups -->
<html>
  <canvas id="canvas" width="400" height="500" style="border: 1px solid black;"></canvas>
</html>

<!-- script is the place we write the code -->
<!-- we are using javascript -->
<script>
  // we get the context from html
  var canvas = document.getElementById("canvas");
  var ctx = canvas.getContext("2d");
  var WIDTH = 400;
  var HEIGHT = 500;

  // draw background
  var img_background = new Image();
  img_background.src = "img/background1.jpg";
  img_background.onload = function() {
    ctx.drawImage(img_background, 0, 0, WIDTH, HEIGHT);
  }

  // we are going to define a Player class
  class Player {
    // you need a constructor
    constructor(id, x, y, speed, src, width, height){
      this.id = id;
      this.x = x;
      this.y = y;
      this.speed = speed;
      this.width = width;
      this.height = height;
      // we need to convert src into image
      this.img = new Image();
      this.img.src = src;
    }
  }

  var player = new Player(0, 180, HEIGHT, -5, "img/player.png", 60, 40);

  class Enemy {
    constructor(id,type, x, y, speed){
      this.id = id;
      this.x = x;
      this.y = y;
      this.speed = speed;
      // type 1: enemy 1, type 2: enemy 2, type 3: boss
      if (type == 1){
        this.width = 28;
        this.height = 35;
        this.img = new Image();
        this.img.src = "img/enemy1.png";      
      }
      else if (type == 2){
        this.width = 45;
        this.height = 35;
        this.img = new Image();
        this.img.src = "img/enemy2.png";           
      }
      else {  // type 3
        this.width = 106;
        this.height = 104;
        this.img = new Image();
        this.img.src = "img/boss.png";  
      }
    }
  }
  var enemyList = {};

  // we are going to randomly generate the enmey
  function addRandomEnemy(){
    var id = Math.random();
    var type = Math.floor(Math.random() * 3) + 1;
    var x = WIDTH * Math.random();
    var y = HEIGHT * Math.random();
    var speed = Math.random() * 9 + 1;
    var enemy = new Enemy(id, type, x, y, speed);
    enemyList[id] = enemy;
  }
  
  addRandomEnemy();
  addRandomEnemy();
  addRandomEnemy();

  function checkCollision(entity1, entity2){
    var left1 = entity1.x;
    var top1 = entity1.y;
    var right1 = entity1.x + entity1.width;
    var bottom1 = entity1.y + entity1.height;
    var left2 = entity2.x;
    var top2 = entity2.y;
    var right2 = entity2.x + entity2.width;
    var bottom2 = entity2.y + entity2.height;
    return (left1 > left2 && left1 < right2 && top1 > top2 && top1 < bottom2) ||
           (right1 > left2 && right1 < right2 && top1 > top2 && top1 < bottom2) ||
           (left1 > left2 && left1 < right2 && bottom1 > top2 && bottom1 < bottom2) ||
           (right1 > left2 && right1 < right2 && bottom1 > top2 && bottom1 < bottom2) ||
           (left2 > left1 && left2 < right1 && top2 > top1 && top2< bottom1) ||
           (left2 > left1 && left2 < right1 && bottom2 > top1 && bottom2 < bottom1)||
           (right2 > left1 && right2 < right1 && top2 > top1 && top2 < bottom1) ||
           (right2 > left1 && right2 < right1 && bottom2 > top1 && bottom2 < bottom1);
  }
  
  function updateEntityPosition(entity){
    entity.y += entity.speed;
    // if your plane is out of boundary, reset it to the bottom
    if (entity.y < 0) {
      entity.y = HEIGHT;
    }
    // if your enemy is out of boundray, also reset it to the top
    else if (entity.y > HEIGHT){
      entity.y = 0;
    }
  }

  function drawEntity(entity){
    ctx.drawImage(entity.img, entity.x, entity.y, entity.width, entity.height);
  }

// this is the function to update entity (entity could be player, could enemy1)
  function updateEntity(entity){
    updateEntityPosition(entity);
    drawEntity(entity);
  }

  // we are going to update Player using mouse
  document.onmousemove = function(mouse) {
    mouseX = mouse.clientX - canvas.getBoundingClientRect().left;
    mouseY = mouse.clientY - canvas.getBoundingClientRect().top;

    //makesure mouseX, mouseY are always inside the canvas
    if(mouseX < player.width/2){
      mouseX = player.width/2;
    }
    else if (mouseX > WIDTH - player.width/2){
      mouseX = WIDTH - player.width/2;
    }
    if (mouseY < player.height/2){
      mouseY = player.height/2;
    }
    else if(mouseY > HEIGHT - player.height/2){
      mouseY = HEIGHT - player.height/2;
    }

    player.x = mouseX - player.width/2;
    player.y = mouseY - player.height/2;
  }

  // we need to move the player and enemy1
  setInterval(update, 40);  // 40 milli-seconds, 1 second = 1000 ms, 1 sec => 25 times

  function update() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT); // this is to clean up everything
    ctx.drawImage(img_background, 0, 0, WIDTH, HEIGHT);
    // you need to learn how to loop through enemyList
    for(var id in enemyList){
      updateEntity(enemyList[id]);
      if(checkCollision(enemyList[id], player)){
        console.log("Collision!")
      }
    }
    drawEntity(player);
  }
</script>

